// Generated by CoffeeScript 1.3.3
var NavBar;

NavBar = (function() {

  function NavBar() {
    this.mainTitle = $('.post_title > h1');
    this.navBoxUl = $('ul#page_nav');
    this.titlesForNav = this.titlesForNav();
    this.buildNavBox();
    $('li.header_link:first').css('border', 'none');
  }

  NavBar.prototype.build_nav_box = function() {
    if (this.titlesForNav.length) {
      this.mainTitle.attr('id', $.text_to_id(this.mainTitle.text()));
      this.appendTitlestoNavBox();
      this.spaceTheTopicsTitle();
    } else {
      this.navBoxUl.hide();
      $('#container').css("text-align", "center");
      $('#post_container').css("left", "0");
    }
    return $('#page_nav').onePageNav({
      changeHash: true
    });
  };

  NavBar.prototype.append_titles_to_nav_box = function() {
    var $idText, $text, title, _i, _len, _ref, _results;
    this.navBoxUl.append('<li class="title_list_item"><a href="#' + this.mainTitle.attr('id') + '">' + this.mainTitle.text() + '</a></li>');
    _ref = this.titlesForNav;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      title = _ref[_i];
      $text = $(title).text();
      $idText = $.textToID($text);
      $(title).attr('id', $idText).prepend('<a class="subtopic_anchor" href="#' + $idText + '">#</a>');
      _results.push(this.appendListElemtoNavBox($(title), $text, $idText));
    }
    return _results;
  };

  NavBar.prototype.appendListElemtoNavBox = function(elem, linkText, idText) {
    if (window.api) {
      if (elem.is('h3')) {
        return this.navBoxUl.append('<li class="sub_link"><a href="#' + idText + '">' + $.sectionTitletoNavTitle(linkText) + '</a></li>');
      } else {
        return this.navBoxUl.append('<li class="header_link"><a href="#' + idText + '">' + linkText + '</a></li>');
      }
    } else {
      return this.navBoxUl.append('<li><a href="#' + idText + '">' + linkText + '</a></li>');
    }
  };

  NavBar.prototype.titlesForNav = function() {
    if (window.api) {
      return $('h2,h3').not('#wistiacom_footer h3');
    } else {
      return $('h2');
    }
  };

  NavBar.prototype.spaceTheTopicsTitle = function() {
    var $titleLink, $topicsTitleBox;
    $topicsTitleBox = $('#page_nav li:first-child');
    $titleLink = $topicsTitleBox.find('a');
    return $titleLink.css('top', ($topicsTitleBox.height() - $titleLink.height()) / 2);
  };

  return NavBar;

})();

$.browserEscapeCharacters = function(span) {
  return span.html(span.html().replace(/</g, '&lt;').replace(/>/g, '&gt;'));
};

$.textToID = function(text) {
  return text.toLowerCase().replace(/[^\s0-9a-z]/g, '').replace(/\s/g, '_');
};

$.sectionTitletoNavTitle = function(text) {
  if (/\:\s/.test(text)) {
    text = text.split(/\:\s/)[1];
  }
  return text;
};

$(function() {
  window.navBar = new NavBar;
  if ($('span.code').length) {
    $('span.code').each(function() {
      return $.browserEscapeCharacters($(this));
    });
  }
  if ($('pre').length) {
    return $('pre').find('code.language-markup').each(function() {
      return $.browserEscapeCharacters($(this));
    });
  }
});
